<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maklumat Bank - MicroVest</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

    <div class="app-shell">
        <div class="product-page-header">
            <button onclick="history.back()" style="position: absolute; left: 20px; background: none; border: none; color: white; font-size: 20px;">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h2>Tetapan Bank</h2>
            <p>Sila pastikan maklumat bank anda tepat</p>
        </div>

        <div class="info-box">
            <i class="fas fa-exclamation-triangle"></i> 
            Pihak kami tidak bertanggungjawab jika wang dihantar ke akaun yang salah disebabkan kesilapan maklumat anda.
        </div>

        <div class="bank-card">
            <div class="form-group">
    <label>NAMA BANK / EWALLET</label>
    <select id="bankName" class="form-control">
        <option value="">Pilih Bank / eWallet</option>
        <option value="TNG eWallet">TNG eWallet (DuitNow)</option>
        <option value="Maybank">Maybank</option>
        <option value="CIMB">CIMB Bank</option>
        </select>
</div>

<div class="form-group">
    <label>NOMBOR TELEFON TNG / AKAUN</label>
    <input type="number" id="accNumber" class="form-control" placeholder="Contoh: 0123456789">
</div>


            <div class="form-group">
                <label>NAMA PENUH PEMEGANG AKAUN</label>
                <input type="text" id="accName" class="form-control" placeholder="Ikut nama dalam IC">
            </div>

            <button class="btn-main" onclick="saveBankDetails()" style="width: 100%; padding: 15px; margin-top: 10px;">
                SIMPAN MAKLUMAT BANK
            </button>
        </div>

        <nav class="bottom-nav">
            <a href="dashboard.html" class="nav-item">
                <i class="fas fa-home"></i><span>Home</span>
            </a>
            <a href="product_list.html" class="nav-item">
                <i class="fas fa-chart-line"></i><span>Produk</span>
            </a>
            <a href="profile.html" class="nav-item active">
                <i class="fas fa-user-circle"></i><span>Profil</span>
            </a>
        </nav>
    </div>

    <script src="app.js"></script>
    <script>
        async function loadCurrentBank() {
            const { data: { user } } = await client.auth.getUser();
            if (!user) return;

            const { data, error } = await client
                .from('profiles')
                .select('bank_name, bank_acc_no, bank_acc_name')
                .eq('id', user.id)
                .single();

            if (data) {
                document.getElementById('bankName').value = data.bank_name || '';
                document.getElementById('accNumber').value = data.bank_acc_no || '';
                document.getElementById('accName').value = data.bank_acc_name || '';
            }
        }

        async function saveBankDetails() {
            const bName = document.getElementById('bankName').value;
            const bNo = document.getElementById('accNumber').value;
            const bUser = document.getElementById('accName').value;

            if (!bName || !bNo || !bUser) {
                alert("Sila lengkapkan semua maklumat!");
                return;
            }

            const { data: { user } } = await client.auth.getUser();
            
            const { error } = await client
                .from('profiles')
                .update({ 
                    bank_name: bName, 
                    bank_acc_no: bNo, 
                    bank_acc_name: bUser 
                })
                .eq('id', user.id);

            if (error) {
                alert("Gagal simpan: " + error.message);
            } else {
                alert("Maklumat bank berjaya dikemas kini!");
                window.location.href = 'profile.html';
            }
        }

        window.onload = loadCurrentBank;
    </script>
</body>
</html>
