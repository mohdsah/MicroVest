<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jemput Rakan - MicroVest</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

    <div class="app-shell">
        <div class="profile-red-header">
            <i class="fas fa-gift" style="font-size: 40px; color: #ffd700; margin-bottom: 15px;"></i>
            <h2>Program Rujukan</h2>
            <p>Jemput rakan & terima komisen sehingga 15%</p>
        </div>

        <div class="product-detail-card" style="margin-top: -30px;">
            <p style="color: var(--text-muted); font-size: 14px;">Kod Jemputan Anda</p>
            <h1 id="myReferralCode" style="color: var(--primary); font-size: 32px; letter-spacing: 5px; margin: 10px 0;">------</h1>
            
            <div style="background: #fff5f5; padding: 15px; border-radius: 12px; margin: 20px 0; border: 1px dashed var(--primary);">
                <p style="font-size: 12px; color: var(--text-main); margin-bottom: 5px;">Pautan Pendaftaran:</p>
                <p id="refLink" style="font-size: 11px; color: var(--primary); word-break: break-all; font-weight: bold;">Memuatkan pautan...</p>
            </div>

            <button class="btn-confirm-buy" onclick="copyLink()">
                <i class="fas fa-copy"></i> SALIN PAUTAN
            </button>
        </div>

        <div style="padding: 0 20px;">
            <h3 style="margin-bottom: 15px; font-size: 16px;">Ganjaran Pasukan</h3>
            <div class="menu-white" style="margin: 0; padding: 10px;">
                <div class="roi-item">
                    <span>Ahli Tahap 1</span>
                    <span style="color: var(--success); font-weight: bold;">10% Komisen</span>
                </div>
                <div class="roi-item">
                    <span>Ahli Tahap 2</span>
                    <span style="color: var(--success); font-weight: bold;">3% Komisen</span>
                </div>
                <div class="roi-item">
                    <span>Ahli Tahap 3</span>
                    <span style="color: var(--success); font-weight: bold;">2% Komisen</span>
                </div>
            </div>
        </div>

        <nav class="bottom-nav">
            <a href="dashboard.html" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="product_list.html" class="nav-item">
                <i class="fas fa-chart-line"></i>
                <span>Produk</span>
            </a>
            <a href="profile.html" class="nav-item">
                <i class="fas fa-user-circle"></i>
                <span>Profil</span>
            </a>
        </nav>
    </div>

    <script src="app.js"></script>
    <script>
        async function loadReferralInfo() {
            const { data: { user } } = await client.auth.getUser();
            
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            // Gunakan ID pengguna atau sebahagian ID sebagai kod rujukan
            const referralCode = user.id.substring(0, 8).toUpperCase();
            const registrationLink = window.location.origin + "/register.html?ref=" + referralCode;

            document.getElementById('myReferralCode').innerText = referralCode;
            document.getElementById('refLink').innerText = registrationLink;
        }

        function copyLink() {
            const linkText = document.getElementById('refLink').innerText;
            navigator.clipboard.writeText(linkText).then(() => {
                alert("Pautan rujukan telah disalin ke clipboard!");
            }).catch(err => {
                console.error('Gagal menyalin: ', err);
            });
        }

        window.onload = loadReferralInfo;
    </script>
</body>
</html>
